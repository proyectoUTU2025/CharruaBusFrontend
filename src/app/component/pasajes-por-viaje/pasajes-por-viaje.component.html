<div class="table-container content-card">
    <div *ngIf="isLoading" class="spinner-overlay">
        <mat-progress-spinner mode="indeterminate" color="primary"></mat-progress-spinner>
    </div>

    <ng-container *ngIf="!isLoading">
        <table mat-table [dataSource]="pasajes" *ngIf="pasajes.length > 0; else noResults" class="mat-elevation-z1">

            <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef> ID Pasaje </th>
                <td mat-cell *matCellDef="let p"> {{ p.id }} </td>
            </ng-container>
        
            <ng-container matColumnDef="clienteEmail">
                <th mat-header-cell *matHeaderCellDef> Email del Cliente </th>
                <td mat-cell *matCellDef="let p"> {{ p.clienteEmail }} </td>
            </ng-container>
        
            <ng-container matColumnDef="asiento">
                <th mat-header-cell *matHeaderCellDef> Asiento </th>
                <td mat-cell *matCellDef="let p"> {{ p.asiento.numero }} </td>
            </ng-container>
        
            <ng-container matColumnDef="fechaCompra">
                <th mat-header-cell *matHeaderCellDef> Fecha de Compra </th>
                <td mat-cell *matCellDef="let p"> {{ p.fechaCompra | date:'dd/MM/yyyy HH:mm' }} </td>
            </ng-container>
        
            <ng-container matColumnDef="estado">
                <th mat-header-cell *matHeaderCellDef> Estado </th>
                <td mat-cell *matCellDef="let p" class="capitalize"> {{ p.estado }} </td>
            </ng-container>
        
            <ng-container matColumnDef="acciones">
                <th mat-header-cell *matHeaderCellDef> Acciones </th>
                <td mat-cell *matCellDef="let p">
                    <button mat-icon-button color="warn" (click)="refund(p.id)" matTooltip="Reembolsar pasaje"
                        *ngIf="p.estado.toLowerCase() === 'comprado' || p.estado.toLowerCase() === 'confirmado'">
                        <mat-icon>undo</mat-icon>
                    </button>
                </td>
            </ng-container>
        
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>

        <ng-template #noResults>
            <div class="no-results">
              <mat-icon>search_off</mat-icon>
              <h3>No se encontraron pasajes</h3>
              <p>No hay pasajes asociados a este viaje.</p>
            </div>
        </ng-template>
    </ng-container>
</div>