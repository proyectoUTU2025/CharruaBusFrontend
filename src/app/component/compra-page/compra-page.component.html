<mat-horizontal-stepper [selectedIndex]="step" linear class="stepper">
  <mat-step label="Búsqueda" [completed]="step > 0"></mat-step>
  <mat-step *ngIf="tipoViaje === 'IDA'" label="Seleccionar viaje" [completed]="step > 1"></mat-step>
  <mat-step *ngIf="tipoViaje === 'IDA'" label="Asientos" [completed]="step > 2"></mat-step>
  <mat-step *ngIf="tipoViaje === 'IDA'" label="Resumen" [completed]="step > 3"></mat-step>
  <mat-step *ngIf="tipoViaje === 'IDA'" label="Pago"></mat-step>

  <mat-step *ngIf="tipoViaje === 'IDA_Y_VUELTA'" label="Seleccionar ida" [completed]="step > 1"></mat-step>
  <mat-step *ngIf="tipoViaje === 'IDA_Y_VUELTA'" label="Asientos ida" [completed]="step > 2"></mat-step>
  <mat-step *ngIf="tipoViaje === 'IDA_Y_VUELTA'" label="Seleccionar vuelta" [completed]="step > 3"></mat-step>
  <mat-step *ngIf="tipoViaje === 'IDA_Y_VUELTA'" label="Asientos vuelta" [completed]="step > 4"></mat-step>
  <mat-step *ngIf="tipoViaje === 'IDA_Y_VUELTA'" label="Resumen" [completed]="step > 5"></mat-step>
  <mat-step *ngIf="tipoViaje === 'IDA_Y_VUELTA'" label="Pago"></mat-step>
</mat-horizontal-stepper>

<mat-tab-group [selectedIndex]="selectedTabIndex" (selectedIndexChange)="cambiarTipoViaje($event)" class="tabs">
  <mat-tab label="Ida"></mat-tab>
  <mat-tab label="Ida y Vuelta"></mat-tab>
</mat-tab-group>

<mat-card class="compra-card">
  <div class="filters-container">
    <form [formGroup]="searchForm" class="filters">
      <mat-form-field appearance="fill">
        <mat-label>Origen</mat-label>
        <mat-select formControlName="localidadOrigenId">
          <mat-option *ngFor="let o of localidades" [value]="o.id">{{ o.nombreConDepartamento }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Destino</mat-label>
        <mat-select formControlName="localidadDestinoId">
          <mat-option *ngFor="let d of destinos" [value]="d.id">{{ d.nombreConDepartamento }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Fecha Ida</mat-label>
        <input matInput [matDatepicker]="picker" formControlName="fechaDesde" />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="fill" *ngIf="tipoViaje === 'IDA_Y_VUELTA'">
        <mat-label>Fecha Vuelta</mat-label>
        <input matInput [matDatepicker]="pickerVuelta" formControlName="fechaVuelta" />
        <mat-datepicker-toggle matSuffix [for]="pickerVuelta"></mat-datepicker-toggle>
        <mat-datepicker #pickerVuelta></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Pasajeros</mat-label>
        <mat-select formControlName="pasajeros">
          <mat-option *ngFor="let n of [1,2,3,4,5]" [value]="n">{{ n }}</mat-option>
        </mat-select>
      </mat-form-field>

      <div class="filters-actions">
        <button mat-raised-button class="buscar-btn" (click)="buscar()">Buscar</button>
        <button mat-flat-button class="outline-btn" (click)="limpiarFiltros()">Limpiar filtros</button>
      </div>
    </form>
  </div>
</mat-card>

<mat-card class="resultados-card" *ngIf="viajes.length > 0">
  <h3 class="section-title">Viajes Disponibles</h3>

  <div class="viaje-item" *ngFor="let viaje of viajes" (click)="openSeatDialog(viaje)">
    <div class="viaje-info">
      <div>
        <strong>{{ viaje.origen }}</strong> → <strong>{{ viaje.destino }}</strong>
      </div>
      <div>
        {{ viaje.fechaHoraSalida | date: 'shortTime' }} -
        {{ viaje.fechaHoraLlegada | date: 'shortTime' }} ({{ calcularDuracion(viaje.fechaHoraSalida, viaje.fechaHoraLlegada) }})
      </div>
    </div>
    <div class="viaje-extra">
      <span>{{ viaje.asientosDisponibles }} asientos disponibles</span>
      <span class="precio">${{ viaje.precio }}</span>
    </div>
  </div>

  <mat-paginator
    [length]="totalElements"
    [pageSize]="pageSize"
    [pageIndex]="pageIndex"
    [pageSizeOptions]="[5, 10, 20]"
    (page)="cambiarPagina($event)">
  </mat-paginator>
</mat-card>
