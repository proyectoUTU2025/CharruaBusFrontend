<div class="actions-bar" style="margin-bottom: 1em; display: flex; gap: 8px;">
    <button mat-raised-button color="primary" (click)="abrirAltaViajeExpreso()">
        <mat-icon>add</mat-icon> Registrar viaje expreso
    </button>
    <button mat-raised-button color="accent" (click)="abrirAsignarMantenimiento()">
        <mat-icon>build</mat-icon> Asignar mantenimiento
    </button>
</div>

<form [formGroup]="filterForm" class="filters-container" style="margin-bottom: 1em;">
    <mat-form-field appearance="fill">
        <mat-label>Salida desde</mat-label>
        <input matInput [matDatepicker]="picker1" formControlName="fechaHoraSalida" />
        <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
        <mat-datepicker #picker1></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="fill">
        <mat-label>Hasta</mat-label>
        <input matInput [matDatepicker]="picker2" formControlName="fechaHoraLlegada" />
        <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
        <mat-datepicker #picker2></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="fill">
        <mat-label>Origen</mat-label>
        <mat-select formControlName="origenId">
            <mat-option value="">Todos</mat-option>
            <mat-option *ngFor="let id of localidadesKeys" [value]="id">
                {{ localidadesMap[+id] }}
            </mat-option>
        </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill">
        <mat-label>Destino</mat-label>
        <mat-select formControlName="destinoId">
            <mat-option value="">Todos</mat-option>
            <mat-option *ngFor="let id of localidadesKeys" [value]="id">
                {{ localidadesMap[+id] }}
            </mat-option>
        </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill">
        <mat-label>Tipo</mat-label>
        <mat-select formControlName="tipoMovimientoOmnibus">
            <mat-option value="">Todos</mat-option>
            <mat-option value="VIAJE">Viaje</mat-option>
            <mat-option value="EXPRESO">Expreso</mat-option>
            <mat-option value="INICIAL">Inicial</mat-option>
            <mat-option value="MANTENIMIENTO">Mantenimiento</mat-option>
        </mat-select>
    </mat-form-field>

    <button mat-flat-button color="primary" (click)="onSearch()" type="button" style="margin-right: 6px;">
        Buscar
    </button>
    <button mat-stroked-button (click)="onClear()" type="button">
        Limpiar
    </button>
</form>

<mat-progress-spinner *ngIf="history.length === 0 && !filterForm.dirty" mode="indeterminate">
</mat-progress-spinner>

<table mat-table [dataSource]="history" class="mat-elevation-z1" *ngIf="history.length > 0">

    <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef> ID </th>
        <td mat-cell *matCellDef="let m"> {{ m.id }} </td>
    </ng-container>

    <ng-container matColumnDef="fechaHoraSalida">
        <th mat-header-cell *matHeaderCellDef> Salida </th>
        <td mat-cell *matCellDef="let m"> {{ m.fechaHoraSalida | date:'short' }} </td>
    </ng-container>

    <ng-container matColumnDef="fechaHoraLlegada">
        <th mat-header-cell *matHeaderCellDef> Llegada </th>
        <td mat-cell *matCellDef="let m"> {{ m.fechaHoraLlegada | date:'short' }} </td>
    </ng-container>

    <ng-container matColumnDef="origenNombre">
        <th mat-header-cell *matHeaderCellDef> Origen </th>
        <td mat-cell *matCellDef="let m"> {{ getNombreLocalidad(m.origenId) }} </td>
    </ng-container>

    <ng-container matColumnDef="destinoNombre">
        <th mat-header-cell *matHeaderCellDef> Destino </th>
        <td mat-cell *matCellDef="let m"> {{ getNombreLocalidad(m.destinoId) }} </td>
    </ng-container>

    <ng-container matColumnDef="tipoMovimientoOmnibus">
        <th mat-header-cell *matHeaderCellDef> Tipo </th>
        <td mat-cell *matCellDef="let m"> {{ m.tipoMovimientoOmnibus }} </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="columns"></tr>
    <tr mat-row *matRowDef="let row; columns: columns;"></tr>
</table>

<mat-paginator [length]="totalMovimientos" [pageSize]="pageSize" [pageSizeOptions]="[5, 10, 25]"
    (page)="loadHistory($event)" showFirstLastButtons>
</mat-paginator>