<h2 class="titulo">Estadísticas de Compras por Clientes</h2>

<div class="filtros">
    <mat-form-field>
        <mat-label>Fecha inicio</mat-label>
        <input matInput [matDatepicker]="pickerInicio" [formControl]="fechaInicio">
        <mat-datepicker-toggle matSuffix [for]="pickerInicio"></mat-datepicker-toggle>
        <mat-datepicker #pickerInicio></mat-datepicker>
    </mat-form-field>
    
    <mat-form-field>
        <mat-label>Fecha fin</mat-label>
        <input matInput [matDatepicker]="pickerFin" [formControl]="fechaFin">
        <mat-datepicker-toggle matSuffix [for]="pickerFin"></mat-datepicker-toggle>
        <mat-datepicker #pickerFin></mat-datepicker>
    </mat-form-field>
    
    <button mat-button (click)="filtrar()">Filtrar</button>
    <button mat-button [disabled]="isExportingCsv" (click)="exportCsv()">
        {{ isExportingCsv ? 'Descargando CSV...' : 'Descargar CSV' }}
    </button>
    <button mat-button color="primary" (click)="exportPdf()">Descargar PDF</button>
</div>

<div class="grafico-container">
    <canvas baseChart
            [data]="{ labels: chartLabels, datasets: chartData }"
            [type]="chartType"
            [options]="chartOptions"
            height="250">
    </canvas>
</div>

<div class="tabla-container">
    <table mat-table [dataSource]="data" class="mat-elevation-z1 tabla">
        <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef (click)="toggleSort('email')">
                Email
                <span *ngIf="ordenarPor === 'email'">{{ ascendente ? '↑' : '↓' }}</span>
            </th>
            <td mat-cell *matCellDef="let x">{{ x.email }}</td>
        </ng-container>

        <ng-container matColumnDef="cantidadPasajes">
            <th mat-header-cell *matHeaderCellDef (click)="toggleSort('cantidadPasajes')">
                Pasajes
                <span *ngIf="ordenarPor === 'cantidadPasajes'">{{ ascendente ? '↑' : '↓' }}</span>
            </th>
            <td mat-cell *matCellDef="let x">{{ x.cantidadPasajes }}</td>
        </ng-container>

        <ng-container matColumnDef="totalGastado">
            <th mat-header-cell *matHeaderCellDef (click)="toggleSort('totalGastado')">
                Total Gastado
                <span *ngIf="ordenarPor === 'totalGastado'">{{ ascendente ? '↑' : '↓' }}</span>
            </th>
            <td mat-cell *matCellDef="let x">{{ x.totalGastado | currency:'USD':'symbol':'1.2-2' }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="['email','cantidadPasajes','totalGastado']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['email','cantidadPasajes','totalGastado']"></tr>
    </table>

    <mat-paginator [length]="total" [pageSize]="pageSize" [pageIndex]="pageIndex" (page)="load($event)">
    </mat-paginator>
</div>
