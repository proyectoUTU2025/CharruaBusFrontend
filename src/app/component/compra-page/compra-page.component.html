<mat-horizontal-stepper [selectedIndex]="step" linear class="stepper">
  <mat-step label="Búsqueda" [completed]="step > 0"></mat-step>
  <mat-step label="Seleccionar viaje" [completed]="step > 1"></mat-step>
  <mat-step label="Pasajeros" [completed]="step > 2"></mat-step>
  <ng-container *ngIf="tipoViaje === 'IDA'">
    <mat-step label="Resumen" [completed]="step > 3"></mat-step>
  </ng-container>
  <ng-container *ngIf="tipoViaje === 'IDA_Y_VUELTA'">
    <mat-step label="Viaje vuelta" [completed]="step > 3"></mat-step>
    <mat-step label="Asientos vuelta" [completed]="step > 4"></mat-step>
    <mat-step label="Resumen" [completed]="step > 5"></mat-step>
  </ng-container>
</mat-horizontal-stepper>

<mat-tab-group [selectedIndex]="selectedTabIndex" (selectedIndexChange)="cambiarTipoViaje($event)" class="tabs">
  <mat-tab label="Ida"></mat-tab>
  <mat-tab label="Ida y Vuelta"></mat-tab>
</mat-tab-group>

<mat-card class="compra-card" *ngIf="step === 0">
</mat-card>

<mat-card class="viajes-card" *ngIf="step === 1">

</mat-card>

<mat-card class="viajes-card" *ngIf="step === 2">
  <ng-container *ngIf="authService.rol === 'CLIENTE' && userInfo">
  </ng-container>
  <ng-container *ngIf="authService.rol === 'VENDEDOR'">
    <h3>Buscar Cliente por Email</h3>
    <mat-form-field appearance="fill">
      <mat-label>Email</mat-label>
      <input matInput [(ngModel)]="searchTerm" placeholder="ejemplo@correo.com" />
    </mat-form-field>
    <button mat-stroked-button color="primary" (click)="buscarClientes()">Buscar</button>
    <div class="datos-cliente" *ngIf="userInfo">
    </div>
  </ng-container>
  <div class="info-asientos">
    Asientos seleccionados: {{ selectedSeats?.join(', ') || 'Ninguno' }}
  </div>
  <div class="filters-actions">
    <button mat-stroked-button (click)="abrirDialogPasajeros()">Seleccionar Asientos</button>
  </div>
</mat-card>

<mat-card class="viajes-card" *ngIf="step === 3">
  <div class="info-asientos">
    <h4>Asientos Seleccionados</h4>
    <ul>
      <li *ngFor="let a of selectedSeats">Asiento Ida {{ a }}</li>
      <li *ngFor="let a of selectedSeatsVuelta">Asiento Vuelta {{ a }}</li>
    </ul>
  </div>
  <div class="info-pago">
    <h4>Detalle del Pago</h4>
    <p>
      <strong>Ruta:</strong>
      {{ viajeIdaSeleccionado?.origen }} → {{ viajeIdaSeleccionado?.destino }}
    </p>
    <p><strong>Pasaje:</strong> ${{ viajeIdaSeleccionado?.precioEstimado }}</p>
    <p><strong>Cargo por servicio:</strong> $0</p>
    <p>
      <strong>Total:</strong>
      ${{ selectedSeats.length * (viajeIdaSeleccionado?.precioEstimado || 0) }}
    </p>
  </div>
  <div class="filters-actions">
    <button mat-raised-button (click)="confirmarCompra()">Proceder al Pago</button>
  </div>
</mat-card>

<mat-card class="viajes-card" *ngIf="step === 4">
  <p>Estamos redirigiéndote a la pasarela de pago. Por favor no cierres esta ventana.</p>
</mat-card>

<div class="step-buttons">
  <button mat-flat-button (click)="anteriorPaso()" [disabled]="step === 0">Anterior</button>
  <button mat-flat-button color="primary" (click)="siguientePaso()" [disabled]="!puedeAvanzar() || step === 4">
    Siguiente
  </button>
</div>