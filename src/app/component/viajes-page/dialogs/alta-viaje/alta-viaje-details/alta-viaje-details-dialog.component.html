<h2 mat-dialog-title>Alta de Viaje</h2>

<mat-horizontal-stepper [selectedIndex]="step" linear class="stepper">
  <mat-step label="Datos del viaje" [completed]="step > 0"></mat-step>
  <mat-step label="Seleccionar ómnibus" [completed]="step > 1"></mat-step>
  <mat-step label="Confirmación"></mat-step>
</mat-horizontal-stepper>

<mat-dialog-content class="dialog-content">
  <div *ngIf="step === 0" class="step">
    <h3>1. Datos del viaje</h3>

    <mat-form-field appearance="fill">
      <mat-label>Origen</mat-label>
      <mat-select [(ngModel)]="origenId">
        <mat-option *ngFor="let loc of localidades" [value]="loc.id">{{ loc.nombre }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Destino</mat-label>
      <mat-select [(ngModel)]="destinoId">
        <mat-option *ngFor="let loc of localidades" [value]="loc.id">{{ loc.nombre }}</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Fecha salida</mat-label>
      <input matInput [matDatepicker]="pickerSalida" [(ngModel)]="fechaSalida" />
      <mat-datepicker-toggle matSuffix [for]="pickerSalida"></mat-datepicker-toggle>
      <mat-datepicker #pickerSalida></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Fecha llegada</mat-label>
      <input matInput [matDatepicker]="pickerLlegada" [(ngModel)]="fechaLlegada" />
      <mat-datepicker-toggle matSuffix [for]="pickerLlegada"></mat-datepicker-toggle>
      <mat-datepicker #pickerLlegada></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>Precio</mat-label>
      <input matInput type="number" [(ngModel)]="precio" />
    </mat-form-field>
  </div>

  <div *ngIf="step === 1" class="step">
    <h3>2. Seleccionar ómnibus disponible</h3>
    <ng-container *ngIf="buses.length > 0; else sinBuses">
      <mat-selection-list [multiple]="false" (selectionChange)="onBusSeleccionado($event)">
  <mat-list-option *ngFor="let bus of buses" [value]="bus">
    {{ bus.matricula }} - {{ bus.capacidad }} asientos ({{ bus.ubicacionActual }})
  </mat-list-option>
</mat-selection-list>
    
    </ng-container>
    <ng-template #sinBuses>
      <p class="sin-buses">No hay ómnibus disponibles con esos criterios.</p>
    </ng-template>
  </div>

  <div *ngIf="step === 2" class="step">
    <h3>3. Confirmación</h3>
    <p><strong>Salida:</strong> {{ fechaSalida | date:'short' }}</p>
    <p><strong>Llegada:</strong> {{ fechaLlegada | date:'short' }}</p>
    <p><strong>Precio:</strong> {{ precio | currency }}</p>
    <p><strong>Ómnibus:</strong> {{ busSeleccionado?.matricula }}</p>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-stroked-button color="primary" (click)="cancelar()">Cancelar</button>
  <button mat-stroked-button color="primary" *ngIf="step > 0" (click)="anterior()">Anterior</button>
  <button
    mat-flat-button
    class="create-btn"
    *ngIf="step < 2"
    (click)="siguiente()"
    [disabled]="
      (step === 0 && (!origenId || !destinoId || !fechaSalida || !fechaLlegada || precio <= 0)) ||
      (step === 1 && !busSeleccionado)
    "
  >
    Siguiente
  </button>
  <button mat-flat-button class="create-btn" *ngIf="step === 2" (click)="confirmar()">Confirmar</button>
</mat-dialog-actions>
